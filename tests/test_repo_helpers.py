import pytest\n\nimport main\n\n\n@pytest.mark.asyncio\nasync def test_move_file_happy_path(monkeypatch: pytest.MonkeyPatch) -> None:\n    monkeypatch.setattr(main, 'WRITE_ALLOWED', True)\n\n    calls: dict[str, object] = {}\n\n    async def fake_decode(full_name: str, path: str, ref: str):\n        calls['decode_args'] = (full_name, path, ref)\n        return {'text': 'hello'}\n\n    async def fake_apply_text_update_and_commit(**kwargs):\n        calls['apply_args'] = kwargs\n        return {'commit': {'sha': 'abc123'}}\n\n    async def fake_delete_file(**kwargs):\n        calls['delete_args'] = kwargs\n        return {'commit': {'sha': 'def456'}}\n\n    def fake_ensure_write_allowed(context: str) -> None:\n        calls['write_context'] = context\n\n    monkeypatch.setattr(main, '_decode_github_content', fake_decode)\n    monkeypatch.setattr(main, 'apply_text_update_and_commit', fake_apply_text_update_and_commit)\n    monkeypatch.setattr(main, 'delete_file', fake_delete_file)\n    monkeypatch.setattr(main, '_ensure_write_allowed', fake_ensure_write_allowed)\n\n    result = await main.move_file(\n        full_name='owner/repo',\n        from_path='old/path.py',\n        to_path='new/path.py',\n        branch='feature',\n        message='Move file',\n    )\n\n    assert calls['decode_args'] == ('owner/repo', 'old/path.py', 'feature')\n    assert calls['apply_args']['full_name'] == 'owner/repo'\n    assert calls['apply_args']['path'] == 'new/path.py'\n    assert calls['apply_args']['branch'] == 'feature'\n    assert calls['delete_args']['path'] == 'old/path.py'\n    assert calls['delete_args']['branch'] == 'feature'\n    assert 'move_file from old/path.py to new/path.py in owner/repo' in calls['write_context']\n    assert result['status'] == 'moved'\n