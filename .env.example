# Example environment configuration for Adaptiv Controller GitHub MCP server
#
# Copy this file to .env and adjust values as needed. All variables are optional
# unless otherwise noted; defaults are shown in comments and populated below.
#
# The concrete values in this example are tuned for a small deployment such as
# a Render instance with ~2GB RAM and 1 CPU. They aim to be safe-but-capable
# rather than maximally aggressive so the server stays responsive under load.
# -----------------------------------------------------------------------------
# Core GitHub authentication (REQUIRED)
# -----------------------------------------------------------------------------
# Personal access token or GitHub App token used for all GitHub API calls.
# At least one of these must be set. If both are set, GITHUB_PAT wins.
GITHUB_PAT=
GITHUB_TOKEN=

# Optional override for GitHub API base URL (for GHE or proxies).
# Default: https://api.github.com
GITHUB_API_BASE=https://api.github.com

# Render Public API (optional) - enables render_* observability tools
RENDER_API_BASE=https://api.render.com/v1
RENDER_API_KEY=
RENDER_API_TOKEN=
# Default resource/service id (e.g., srv-xxxx) for render_* tools
RENDER_RESOURCE=
RENDER_SERVICE_ID=
# Render owner/workspace id (required by Render /logs).
# You can find it by calling GET /services/:serviceId in the Render API (field: ownerId),
# or set it explicitly here to avoid the extra lookup.
RENDER_OWNER_ID=

# -----------------------------------------------------------------------------
# Controller repo / contract configuration
# -----------------------------------------------------------------------------
# The controller repository this MCP server treats as its own "controller repo".
# Default: Proofgate-Revocations/chatgpt-mcp-github (this product repo).
# For buyers, set this to <your-username>/<your-repo> after you unzip and push.
GITHUB_MCP_CONTROLLER_REPO=Proofgate-Revocations/chatgpt-mcp-github

# Machine-readable contract version between controllers and this server.
# Default: 2025-03-16
GITHUB_MCP_CONTROLLER_CONTRACT_VERSION=2025-03-16

# Default controller branch used when full_name matches controller repo and
# callers do not specify a ref or use "main".
# Default: main
GITHUB_MCP_CONTROLLER_BRANCH=main

# Optional JSON map of repo defaults (e.g., default branches) to reduce API calls.
# Example: {"owner/repo": {"default_branch": "main"}}
GITHUB_REPO_DEFAULTS={}

# Automatically allow write-tagged tools without an explicit authorize call.
# This is primarily useful for development environments.
# Values considered true: 1, true, yes, y, on (case-insensitive).
# Default: false
GITHUB_MCP_AUTO_APPROVE=false

# -----------------------------------------------------------------------------
# Workspace and execution configuration
# -----------------------------------------------------------------------------
# Base directory for persistent workspaces used by run_command/run_tests.
# Default:
# - Local dev: $(TMPDIR)/mcp-github-workspaces
# - Render:    /opt/render/project/.mcp-github-workspaces
MCP_WORKSPACE_BASE_DIR=/tmp/mcp-github-workspaces

# -----------------------------------------------------------------------------
# HTTP client tuning (GitHub and external)
# -----------------------------------------------------------------------------
# HTTPX timeout in seconds for GitHub/external requests.
# Default: 150
HTTPX_TIMEOUT=150

# Maximum total concurrent connections in the HTTPX connection pool.
# Default: 300; for a 2GB RAM / 1 CPU instance, 100 is a safer upper bound.
HTTPX_MAX_CONNECTIONS=100

# Maximum keep-alive connections in the HTTPX connection pool.
# Default: 200; tuned down to 50 for smaller instances.
HTTPX_MAX_KEEPALIVE=50

# Enable HTTP/2 for HTTPX clients.
# Default: 1 (enabled)
HTTPX_HTTP2=1

# Maximum concurrency for internal operations (semaphores, etc.).
# Default: 80; tuned to 32 for a 2GB RAM / 1 CPU deployment to avoid
# overwhelming the process while still allowing parallelism.
MAX_CONCURRENCY=32

# Concurrency specifically for fetch_files operations.
# Default: MAX_CONCURRENCY; tuned to 16 to reduce peak memory when
# fetching many files concurrently on smaller instances.
FETCH_FILES_CONCURRENCY=16

# -----------------------------------------------------------------------------
# Git identity for commits
# -----------------------------------------------------------------------------
# Default author/committer information used when creating commits.
# Defaults: Ally / ally@example.com if unset.
GIT_AUTHOR_NAME=Ally
GIT_AUTHOR_EMAIL=ally@example.com
GIT_COMMITTER_NAME=Ally
GIT_COMMITTER_EMAIL=ally@example.com

# -----------------------------------------------------------------------------
# File cache (GitHub content fetches)
# -----------------------------------------------------------------------------
# In-memory cache limits for fetched file blobs/metadata.
# Defaults: 500 entries / 52428800 bytes (50MB).
FILE_CACHE_MAX_ENTRIES=500
FILE_CACHE_MAX_BYTES=52428800

# Tool output truncation (stdout/stderr)
# Upper bounds for tool stdout/stderr payloads returned to the connector.
# Set to 0 or a negative value to disable truncation.
# Defaults: 12000 / 12000 / 20000 (safe server-side truncation).
# If you need smaller payloads on constrained hosts, start with something like:
#   12000 / 6000 / 18000
TOOL_STDOUT_MAX_CHARS=12000
TOOL_STDERR_MAX_CHARS=12000
TOOL_STDIO_COMBINED_MAX_CHARS=20000

# get_file_with_line_numbers defaults (prevents huge payloads / hangs)
# Defaults: 200 lines / 20000 chars; hard max: 20000 lines (set <=0 to disable hard max)
GET_FILE_WITH_LINE_NUMBERS_DEFAULT_MAX_LINES=200
GET_FILE_WITH_LINE_NUMBERS_DEFAULT_MAX_CHARS=20000
GET_FILE_WITH_LINE_NUMBERS_HARD_MAX_LINES=20000

# Unified diff logging for write tools (stdout logs only).
# Limits how much of the colored diff is printed to Render logs at DETAILED level.
# Defaults: 200 lines / 20000 chars.
WRITE_DIFF_LOG_MAX_LINES=200
WRITE_DIFF_LOG_MAX_CHARS=20000

# -----------------------------------------------------------------------------
# Logging configuration
# Default: INFO
# Valid: DEBUG, DETAILED, INFO, CHAT, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Log style for stdout logs.
# - plain: no ANSI escape sequences (recommended for connector UI stability)
# - color/ansi/colored: add ANSI color codes to level names
# Default: plain
LOG_STYLE=plain

# Log format; see Python logging format strings.
# Default: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
LOG_FORMAT="%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# In-memory log buffers exposed via diagnostics tools.
# Set to 0 to disable buffering.
# Defaults: 0 / 0 (disabled).
MCP_ERROR_LOG_CAPACITY=0
MCP_LOG_RECORD_CAPACITY=0

# -----------------------------------------------------------------------------
# Sandbox / content rewrite configuration
# -----------------------------------------------------------------------------
# Optional base URL used when rewriting content paths for sandboxed environments.
# If set, sandbox-aware tools can surface content URLs relative to this base.
SANDBOX_CONTENT_BASE_URL=

# -----------------------------------------------------------------------------
# Process-level settings
# -----------------------------------------------------------------------------
# Port for the HTTP server (used by uvicorn).
# Default: 8000
PORT=8000

# Soft limit for run_command.command length to discourage huge inline scripts.
# Default: 20000; large enough for common multi-line scripts while still bounded.
RUN_COMMAND_MAX_CHARS=20000
